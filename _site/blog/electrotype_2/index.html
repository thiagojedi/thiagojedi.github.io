<!DOCTYPE html>
<html><head></head><body><nav aria-label="breadcrumb"><ul><li><a href="/">Página Inicial</a></li>/<li><a href="/blog/">Blog</a></li>/<li aria-current="page">Post</li></ul></nav><main><article><h1>ElectroType Reaction: Getting things Done</h1><div><p>Nesse segundo post de uma série de quatro, vou explicar o ambiente de trabalho para desenvolvermos
uma aplicação Electron com Typescript. Desde a estrutura de pastas até como criar um bom pipeline de
desenvolvimento e compilação.</p>
<h2>As primeiras coisas primeiro</h2>
<p>Sem muita conversa: vamos por a mão na massa. Como eu disse no blog anterior, todas as ferramentas
que nós vamos usar dependem da linguagem JavaScript, e já que <em>ainda</em> não estamos rodando nada num
navegador, precisamos do <a href="https://nodejs.org/docs/latest/api/globals.html#globals_dirname" title="Documentação sobre o dirname.">Node.js</a> instalado com o npm.</p>
<p>Além disso, o TypeScript é muito melhor aproveitado se programado em algum editor que tenha o plugin
de autocomplete dele. O site oficial contém links para alguns <a href="https://www.typescriptlang.org/index.html#download-links" title="Área de downloads do TypeScript">editores e seus plugins</a>.
Recomendo fortemente a utilização de algum deles durante esse tutorial.</p>
<p>Vamos organizar nosso projeto da seguinte forma:</p>
<pre class="language-none" tabindex="0"><code class="language-none">electrotype/
- img/  # imagens
- css/  # folhas de estilo
- src/  # aqui vão ficar os códigos
    - main.ts
    - index.html
- package.json
- tsconfig.json
</code></pre>
<p>Nada de outro mundo, né? Os mais sagazes também devem ter percebido que o arquivo <code>index.html</code> está
dentro do diretório <code>src/</code>, e não em alguma pasta específica para Views. Você pode criar uma pasta,
mas como nesse tutorial desenvolveremos uma SPA e só teremos esse arquivo HTML, não acho necessário.</p>
<p>O arquivo <code>package.json</code> vai ficar nesse formato:</p>
<pre class="language-json" tabindex="0"><code class="language-json">{
  "name": "eletrotype",
  "version": "1.0.0",
  "description": "",
  "main": "src/main.js",
  "scripts": {
    "start": "electron .",
    "prestart": "tsc -p ."
  },
  "license": "MIT",
  "devDependencies": {
    "@types/electron": "^1.4.37",
    "@types/node": "^6.0.70",
    "electron": "1.6.6",
    "typescript": "^2.2.2"
  }
}
</code></pre>
<p>Algumas coisas a serem comentadas sobre esse arquivo:</p>
<p>1- Perceba que existe na linha <code>"main": "src/main.js"</code> estamos indicando que vamos rodar um arquivo
<code>.js</code> que ainda não existe. Não se preocupe pois ele será gerado pelo compilador do TypeScript.</p>
<p>2- Para garantir que não vamos esquecer de compilar as mudanças feitas nos arquivos <code>.ts</code>, a linha
<code>"prestart": "tsc -p ."</code> faz o npm rodar o compilador antes de iniciar o programa.</p>
<p>3- O Electron não recomenda atualização automática dele mesmo como dependencia, por isso colocamos
<code>"electron": "1.6.6"</code> e não <code>"electron": "^1.6.6"</code>, por exemplo.</p>
<p>4- As dependencias <code>@types/*</code> vão ajudar o compilador e o plugin do seu editor a verificar a
existência de métodos e campos de objetos existentes nessas bibliotecas.</p>
<aside class="alert alert-info">
<strong>Dica:</strong> O arquivo <code>package.json</code> pode ser criado usando o comando <code>npm init</code>. E as dependencias adicionadas via <code>npm install -D electron typescript @types/electron @types/node</code>
</aside>
<p>Enquanto isso, o <code>tsconfig.json</code> terá essa configuração:</p>
<pre class="language-json" tabindex="0"><code class="language-json">{
  "compilerOptions": {
    "module": "commonjs",
    "target": "es5",
    "sourceMap": true,
    "strictNullChecks": true
  },
  "includes": ["./src/**/*.ts"]
}
</code></pre>
<p>Acredito que seja uma configuração bem óbvia para quem já conhece um pouco de JavaScript.</p>
<p>Existem duas coisas nesse arquivo que são interessantes: a entrada <code>includes</code> e a
<code>strictNullChecks</code>.</p>
<p>Na primeira, nós dizemos que nós vamos compilar apenas os arquivos <code>.ts</code> de dentro da pasta
<code>./src/</code>. Não que o compilador vá compilar arquivos <code>.html</code> ou algo assim, mas ajuda a otimizar seu
funcionamento.</p>
<p>A segunda eu vou falar um pouco mais pra frente.</p>
<p>Demais opções podem ser encontradas na <a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" title="Documentação do compilador do TS.">documentação oficial</a> do TypeScript. A maioria delas
vão ajudá-lo a não fazer besteira no seu código. Mas isso é tema para outro post.</p>
<aside class="alert alert-info">
<strong>Dica:</strong> Um arquivo <code>tsconfig.json</code> básico pode ser criado usando o comando <code>tsc --init</code>.
</aside>
<p>Já podemos rodar o comando <code>npm install</code> dentro do nosso diretório para garantir que temos todas as
nossas bibliotecas no lugar.</p>
<p>Com isso, já temos tudo pra começar a programar de verdade.</p>
<h2>Olá, Electron!</h2>
<p>Vamos criar uma coisinha básica pra mostrar no seu aplicativo Electron. No seu editor favorito, abra
o arquivo <code>/src/index.html</code> e crie qualquer coisa que você queira.</p>
<p>No meu, eu vou colocar, dentro da tag <code>&lt;body&gt;</code>, o seguinte:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Olá, Electron<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>corpo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Carregado via BrowserWindow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Nada demais, uh? É só para termos algo para mostrar mesmo.</p>
<p>Agora vamos com calma no código para mostrar essa página. Abra seu arquivo <code>main.ts</code> e digite o
seguinte:</p>
<pre class="language-ts" tabindex="0"><code class="language-ts">import * as Electron from 'electron'

let janela: Electron.BrowserWindow //Linha A

function criarJanela() { //Linha B
	janela = new Electron.BrowserWindow({
		width: 800,
		height: 600
	})

    janela.loadURL("file://" + __dirname "/index.html")
}

Electron.app.on("ready", criarJanela) //Linha C
</code></pre>
<p>Esse é o código mínimo para termos uma janela em branco na tela. Perceba que, como nossa aplicação é
bem simples e vai ter apenas uma janela, ela vai ficar como variável global (Linha A), e avisamos
pro compilador do TypeScript que essa variável será uma BrowserWindow. Após declararmos a janela,
criamos uma função (Linha B) para instanciarmos ela e chamamos essa função quando a aplicação
estiver pronta (Linha C).</p>
<p>Note que nós carregamos o <code>index.html</code> do nosso sistema de arquivos, por isso o protocolo <code>file://</code>.
Também utilizamos a variável <code>__dirname</code>, <a href="https://nodejs.org/docs/latest/api/globals.html#globals_dirname" title="Documentação sobre o dirname.">setada pelo Node.JS</a>, para garantir que o caminho
é relativo ao local do arquivo que estamos rodando.</p>
<p>Rode o comando <code>npm start</code>, você deve ter algo parecido com isso:</p>
<p><img src="/images/electron_1.png" alt="Hello, Electron"></p>
<p>E fim! Temos um aplicativo! Quer dizer... quase.</p>
<h2>Evoluindo no Darwin</h2>
<p>Lembre-se que o Electron é multiplataforma. Então existem algumas alterações que precisam ser feitas
para o seu aplicativo funcionar bem no <a href="https://en.wikipedia.org/wiki/MacOS#macOS" title="O nome é macOS agora :D">macOS</a>.</p>
<p>É o comportamento padrão de um aplicativo no macOS que, ao clicar no botão de fechar, o aplicativo
não termine. O aplicativo só pode se terminar se o usuário pedir por isso ativamente.</p>
<p>Dito isso, vamos mudar a função de criar a janela para o seguinte:</p>
<pre class="language-ts" tabindex="0"><code class="language-ts">function criarJanela() {
  janela = new Electron.BrowserWindow({
    width: 800,
    height: 600,
  });

  janela.loadURL('file://' + __dirname + '/index.html');

  janela.on('close', function () {
    janela = null;
  });
}
</code></pre>
<p>Vamos tornar a nossa janela nula quando ela for fechada, liberando espaço em memória. Além disso, no
escopo principal, adicionaremos código para dois eventos do nosso <code>Electron.app</code>:</p>
<pre class="language-ts" tabindex="0"><code class="language-ts">Electron.app.on('window-all-closed', function () {
  if (process.platform !== 'darwin') Electron.app.quit();
});

Electron.app.on('activate', function () {
  if (janela === null) criarJanela();
});
</code></pre>
<p>O que fizemos aqui foi dizer pro <code>app</code> só sair(quit) após todas as janelas forem fechadas somente se
não estivermos no macOS (que usa o kernel "darwin"). Quando não há janelas, mas o aplicativo ainda
está rodando, o usuário pode ativar o ícone e uma nova janela será criada e exibida.</p>
<p>Tente rodar novamente o <code>npm start</code> para testar esse nosso código. Você deve ver algo nesse sentido:</p>
<pre class="language-none" tabindex="0"><code class="language-none">src/main.ts(14,9): error TS2322: Type 'null' is not assignable to type 'BrowserWindow'.
</code></pre>
<p>Se lembra que configuramos o compilador com o parâmetro <code>strictNullChecks: true</code>? É exatamente pra
isso que ele serve. O que aconteceu é que nós tentamos setar a variável <code>janela</code> para <code>null</code> mas
essa variável não pode ser nula. Isso é bastante útil quando estamos tratando com variáveis globais
que podem ser utilizadas em vários locais do código. É bom que saibamos que esse código pode
interferir na nossa lógica.</p>
<p>Como esse arquivo é pequeno, e nós sabemos todos os locais que a <code>janela</code> é chamada, vamos apenas
mudar a declaração dela para: <code>let janela: Electron.BrowserWindow | null</code>. Ou seja, a janela pode
ser uma BrowserWindow OU nula.</p>
<p>Eis o código final:</p>
<pre class="language-typescript" tabindex="0"><code class="language-typescript">import * as Electron from 'electron';

let janela: Electron.BrowserWindow | null;

function criarJanela() {
  janela = new Electron.BrowserWindow({
    width: 800,
    height: 600,
  });

  janela.loadURL('file://' + __dirname + '/index.html');

  janela.on('close', () =&gt; {
    janela = null;
  });
}

Electron.app.on('ready', criarJanela);

Electron.app.on('window-all-closed', () =&gt; {
  if (process.platform !== 'darwin') Electron.app.quit();
});

Electron.app.on('activate', () =&gt; {
  if (janela === null) {
    criarJanela();
  }
});
</code></pre>
<p>Agora sim. Terminamos por hoje.</p>
<p>Se você utiliza algum editor com plugin do TypeScript, não copie e cole esses códigos, digite-os
você mesmo. Perceba que ao digitar você não só já vê os erros como o da janela nula, como também
deve ter sugestões de códigos bem mais sucintas que se você estivesse escrevendo apenas JavaScript.</p>
<p>No próximo post, nós veremos como tornar a nossa página html em uma aplicação usando o ReactJS. Até
lá, veja a <a href="https://electron.atom.io/docs/api/browser-window/#new-browserwindowoptions" title="Documentação do BrowserWindow">documentação do Electron</a> para brincar com os parâmetros do construtor de
BrowserWindow (eu gosto muito de <code>frame: false</code> e <code>kiosk: true</code>)</p>
<p>Que a Força esteja com vocês!</p>
<hr>
<h4>UPDATE (<time datetime="2018-02-11T00:00">11/02/2018</time>):</h4>
<p>Essa parte do tutorial pode ser substituída utilizando a ferramenta <a href="https://electronforge.io/" title="Site oficial do Electron Forge">Electron Forge</a>. Para
utilizar o ReactJS com Typescript deve-se utilizar o seguinte comando para criar o projeto:</p>
<pre class="language-console" tabindex="0"><code class="language-console">$ electron-forge init meu-novo-projeto --template=react-typescript
</code></pre>
<p>Esse comando cria uma pasta chamada "meu-novo-projeto" com tudo o que você precisa para criar um
aplicativo nos moldes desse tutorial.</p>
</div></article></main></body></html>